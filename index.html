<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <link type="image/png" sizes="16x16" rel="icon" href="favicons/icons8-favorite-windows-11-color-16.png" />
        <link type="image/png" sizes="32x32" rel="icon" href="favicons/icons8-favorite-windows-11-color-32.png" />
        <link type="image/png" sizes="96x96" rel="icon" href="favicons/icons8-favorite-windows-11-color-96.png" />
        <title>Happy 5 Months ‚ù§Ô∏è</title>
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&family=Pacifico&family=Roboto:wght@400;600&display=swap"
            rel="stylesheet"
        />
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                -webkit-tap-highlight-color: transparent;
            }

            body {
                font-family: 'Roboto', 'Noto Color Emoji', sans-serif;
                font-weight: 400;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
                background-attachment: fixed;
                min-height: 100vh;
                overflow-x: hidden;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
                -webkit-overflow-scrolling: touch;
                overscroll-behavior: none;
            }

            .page {
                display: none;
                min-height: 100vh;
                padding: 20px;
                opacity: 0;
                transition: opacity 0.5s ease;
                transform: translateZ(0);
                -webkit-transform: translateZ(0);
                will-change: opacity;
            }

            .page.active {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                opacity: 1;
            }

            /* Welcome Page Styles */
            .welcome-container {
                background: rgba(255, 255, 255, 0.95);
                padding: 50px 30px;
                border-radius: 25px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
                text-align: center;
                max-width: 500px;
                width: 90%;
                transform: translateZ(0);
                -webkit-transform: translateZ(0);
                backface-visibility: hidden;
                -webkit-backface-visibility: hidden;
            }

            .welcome-title {
                font-family: 'Pacifico', cursive;
                font-size: 36px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                margin-bottom: 20px;
                will-change: auto;
            }

            .hearts-decoration {
                font-size: 32px;
                margin: 20px 0;
            }

            .welcome-subtitle {
                font-size: 18px;
                color: #666;
                margin-bottom: 30px;
                line-height: 1.6;
            }

            .arrow-button {
                display: flex;
                margin: 0 auto;
                margin-top: 20px;
                padding: 16px 40px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                border-radius: 50px;
                font-size: 18px;
                font-weight: 600;
                cursor: pointer;
                box-shadow: 0 10px 30px rgba(118, 75, 162, 0.4);
                touch-action: manipulation;
                transform: translateZ(0);
                -webkit-transform: translateZ(0);
                backface-visibility: hidden;
                -webkit-backface-visibility: hidden;
                transition: transform 0.1s ease, box-shadow 0.1s ease;
            }

            .arrow-button:active {
                transform: translateZ(0) scale(0.95);
                -webkit-transform: translateZ(0) scale(0.95);
                box-shadow: 0 5px 20px rgba(118, 75, 162, 0.3);
            }

            /* Letter Overlay Styles */
            .letter-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.85);
                z-index: 1000;
                align-items: center;
                justify-content: center;
                opacity: 0;
                transition: opacity 0.3s ease;
                transform: translateZ(0);
                -webkit-transform: translateZ(0);
                backface-visibility: hidden;
                -webkit-backface-visibility: hidden;
            }

            .letter-overlay.show {
                display: flex;
                opacity: 1;
            }

            .envelope {
                width: 280px;
                height: 187px;
                position: relative;
                cursor: pointer;
                transform: translateZ(0);
                -webkit-transform: translateZ(0);
            }

            .envelope-body {
                position: absolute;
                left: 0;
                width: 280px;
                height: 140px;
                background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
                border: 3px solid #e89f8a;
                border-top: none;
                border-radius: 0 0 10px 10px;
                transform: translateZ(0);
                -webkit-transform: translateZ(0);
            }

            .envelope-body::before {
                content: 'üíå';
                position: absolute;
                top: 35px;
                left: 50%;
                transform: translateX(-50%) translateZ(0);
                -webkit-transform: translateX(-50%) translateZ(0);
                font-size: 48px;
            }

            .envelope-flap {
                width: 0;
                height: 0;
                border-left: 140px solid transparent;
                border-right: 140px solid transparent;
                border-top: 93px solid #fff5ee;
                position: absolute;
                top: 0;
                left: 0;
                transition: transform 0.8s ease;
                transform-origin: top;
                z-index: 20;
                will-change: transform;
            }

            .envelope.open .envelope-flap {
                transform: rotateX(180deg) translateZ(0);
                -webkit-transform: rotateX(180deg) translateZ(0);
                border-top-color: #ffecd2;
            }

            .letter-content {
                display: none;
                background: #ffffff;
                padding: 40px 30px;
                border-radius: 20px;
                max-width: 90%;
                width: 600px;
                max-height: 85vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                -webkit-overflow-scrolling: touch;
                overscroll-behavior: contain;
                transform: translateZ(0);
                -webkit-transform: translateZ(0);
                backface-visibility: hidden;
                -webkit-backface-visibility: hidden;
            }

            .letter-content.show {
                display: block;
                animation: slideUp 0.5s ease-out;
            }

            @keyframes slideUp {
                from {
                    opacity: 0;
                    transform: translateY(30px) translateZ(0);
                }
                to {
                    opacity: 1;
                    transform: translateY(0) translateZ(0);
                }
            }

            .letter-content h2 {
                font-family: 'Pacifico', cursive;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                margin-bottom: 25px;
                font-size: 26px;
            }

            .letter-content p {
                line-height: 1.8;
                color: #444;
                margin-bottom: 18px;
                text-align: justify;
                font-size: 16px;
            }

            .letter-content .signature {
                text-align: right;
                font-weight: 600;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                margin-top: 30px;
                font-style: italic;
                font-size: 18px;
            }

            /* Galaxy Page Styles */
            #galaxyPage {
                background: #0a0015;
                padding: 0;
                overflow: hidden;
            }

            #galaxyPage.active {
                display: block;
            }

            #canvas {
                display: block;
                width: 100%;
                height: 100vh;
            }

            .galaxy-info {
                position: absolute;
                top: 30px;
                left: 50%;
                transform: translateX(-50%);
                color: #ff69b4;
                text-align: center;
                font-size: 32px;
                font-weight: bold;
                text-shadow: 0 0 20px rgba(255, 105, 180, 0.8), 0 0 40px rgba(255, 105, 180, 0.5);
                z-index: 10;
                pointer-events: none;
                animation: glow 2s ease-in-out infinite;
            }

            @keyframes glow {
                0%, 100% {
                    text-shadow: 0 0 20px rgba(255, 105, 180, 0.8), 0 0 40px rgba(255, 105, 180, 0.5);
                }
                50% {
                    text-shadow: 0 0 30px rgba(255, 105, 180, 1), 0 0 60px rgba(255, 105, 180, 0.8);
                }
            }

            .subtitle {
                font-size: 16px;
                font-weight: normal;
                margin-top: 10px;
                color: #ffb3d9;
            }

            .music-control {
                position: fixed;
                bottom: 25px;
                right: 25px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-radius: 50%;
                width: 65px;
                height: 65px;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                box-shadow: 0 8px 25px rgba(118, 75, 162, 0.4);
                z-index: 1001;
                touch-action: manipulation;
                font-size: 30px;
                transform: translateZ(0);
                -webkit-transform: translateZ(0);
                backface-visibility: hidden;
                -webkit-backface-visibility: hidden;
                transition: transform 0.1s ease;
            }

            .music-control:active {
                transform: translateZ(0) scale(0.95);
                -webkit-transform: translateZ(0) scale(0.95);
            }

            .hearts-animation {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: 1;
                display: none;
                transform: translateZ(0);
                -webkit-transform: translateZ(0);
            }

            .hearts-animation.active {
                display: block;
            }

            .hearts-animation.paused .heart {
                animation-play-state: paused;
            }

            .heart {
                position: absolute;
                font-size: 24px;
                opacity: 0;
                animation: float-heart 5s ease-in forwards;
                will-change: transform, opacity;
                backface-visibility: hidden;
                -webkit-backface-visibility: hidden;
                left: var(--random-left);
                animation-delay: var(--random-delay);
            }

            @keyframes float-heart {
                0% {
                    transform: translateY(100vh) translateZ(0) scale(1);
                    opacity: 0.7;
                }
                50% {
                    opacity: 0.9;
                }
                100% {
                    transform: translateY(-100px) translateZ(0) scale(0.6);
                    opacity: 0;
                }
            }

            .rotate-notice {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(10, 0, 21, 0.95);
                z-index: 9999;
                justify-content: center;
                align-items: center;
                flex-direction: column;
            }

            .rotate-icon {
                font-size: 80px;
                margin-bottom: 20px;
                animation: rotate-animation 2s ease-in-out infinite;
            }

            @keyframes rotate-animation {
                0%, 100% {
                    transform: rotate(0deg);
                }
                50% {
                    transform: rotate(90deg);
                }
            }

            .rotate-text {
                color: #ff69b4;
                font-size: 20px;
                text-align: center;
                padding: 0 20px;
                text-shadow: 0 0 10px rgba(255, 105, 180, 0.5);
            }

            @media (max-width: 768px) {
                .welcome-container {
                    padding: 40px 25px;
                }

                .welcome-title {
                    font-size: 30px;
                }

                .letter-content {
                    padding: 30px 20px;
                }

                .letter-content h2 {
                    font-size: 22px;
                }

                .letter-content p {
                    font-size: 15px;
                }

                .envelope {
                    width: 240px;
                    height: 160px;
                }

                .envelope-body {
                    width: 240px;
                    height: 120px;
                }

                .envelope-flap {
                    border-left: 120px solid transparent;
                    border-right: 120px solid transparent;
                    border-top: 80px solid #fff5ee;
                }

                .music-control {
                    width: 55px;
                    height: 55px;
                    font-size: 26px;
                    bottom: 20px;
                    right: 20px;
                }

                .galaxy-info {
                    font-size: 24px;
                    top: 20px;
                }
            }

            @media (max-width: 768px) and (orientation: portrait) {
                #galaxyPage.active .rotate-notice {
                    display: flex !important;
                }
                
                #galaxyPage.active #canvas {
                    display: none;
                }
                
                #galaxyPage.active .galaxy-info {
                    display: none;
                }
            }
            
            @media (orientation: landscape) {
                .rotate-notice {
                    display: none !important;
                }
            }
        </style>
    </head>
    <body>
        <!-- Hearts Animation -->
        <div class="hearts-animation" id="heartsContainer"></div>

        <!-- Page 1 - Welcome -->
        <div class="page active" id="page1">
            <div class="welcome-container">
                <div class="welcome-title">Happy 5 Months</div>
                <div class="hearts-decoration">üíï üíñ üíï</div>
                <div class="welcome-subtitle">
                    Ch√†o anh b√© y√™u c·ªßa em!<br />
                    Em c√≥ ƒëi·ªÅu mu·ªën n√≥i v·ªõi anh...
                </div>
                <button class="arrow-button" onclick="showLetter()">‚ú® M·ªü Th∆∞ T√¨nh ‚ú®</button>
            </div>
        </div>

        <!-- Letter Overlay -->
        <div class="letter-overlay" id="letterOverlay">
            <div class="envelope" id="envelope" onclick="openLetter()">
                <div class="envelope-flap"></div>
                <div class="envelope-body"></div>
            </div>
            <div class="letter-content" id="letterContent">
                <h2>Xin ch√†o anh b√© y√™u c·ªßa em,</h2>
                <p>
                    H√¥m nay tr√≤n 5 th√°ng ch√∫ng m√¨nh b√™n nhau---m·ªôt kho·∫£ng th·ªùi gian kh√¥ng d√†i, nh∆∞ng ƒë·ªß ƒë·ªÉ tr√°i tim em
                    quen v·ªõi s·ª± hi·ªán di·ªán c·ªßa anh, d√π ch·ªâ qua nh·ªØng tin nh·∫Øn, nh·ªØng cu·ªôc g·ªçi v√† nh·ªØng y√™u th∆∞∆°ng t·ª´ xa.
                    Y√™u xa ƒë√¥i khi l√† nh·ªØng ƒë√™m d√†i h∆°n m·ªôt ch√∫t, nh·ªØng nhung nh·ªõ nhi·ªÅu h∆°n m·ªôt ch√∫t... nh∆∞ng c≈©ng ch√≠nh
                    v√¨ th·∫ø m√† m·ªói kho·∫£nh kh·∫Øc ch√∫ng m√¨nh c√≥ c√πng nhau ƒë·ªÅu tr·ªü n√™n qu√Ω gi√° v√† ch√¢n th√†nh h∆°n r·∫•t nhi·ªÅu.
                </p>

                <p>
                    Noel nƒÉm nay l√† Noel ƒë·∫ßu ti√™n c·ªßa ch√∫ng m√¨nh. D√π kh√¥ng ƒë∆∞·ª£c n·∫Øm tay anh ƒëi gi·ªØa ph·ªë ƒë√®n hoa hay t·ª±a
                    v√†o vai anh nghe nh·ªØng b·∫£n nh·∫°c Gi√°ng sinh, nh∆∞ng tim em v·∫´n ƒë·∫ßy √°nh s√°ng---v√¨ em bi·∫øt ·ªü m·ªôt n∆°i
                    kh√°c, anh c≈©ng ƒëang nghƒ© v·ªÅ em.
                </p>

                <p>
                    C·∫£m ∆°n anh v√¨ ng√†y h√¥m ·∫•y ƒë√£ xu·∫•t hi·ªán trong cu·ªôc ƒë·ªùi em, ƒë·ªÉ em bi·∫øt r·∫±ng h·∫°nh ph√∫c v·∫´n ·ªü ƒë√≥ ch·ªù
                    m√¨nh t√¨m th·∫•y, v√† em v·∫´n x·ª©ng ƒë√°ng ƒë∆∞·ª£c y√™u th∆∞∆°ng. C·∫£m ∆°n anh v√¨ ƒë√£ ƒë·∫øn v√† th∆∞∆°ng em m·ªôt c√°ch tr·ªçn
                    v·∫πn, ch√¢n th√†nh. Anh l√† ng∆∞·ªùi √¢m th·∫ßm xoa d·ªãu nh·ªØng t·ªïn th∆∞∆°ng em t·ª´ng mang, kh√¥ng b·∫≠n t√¢m qu√° kh·ª©
                    em t·ªá ƒë·∫øn nh∆∞·ªùng n√†o; ng∆∞·ª£c l·∫°i, anh mang ƒë·∫øn cho em nh·ªØng ni·ªÅm vui, nh·ªØng n·ª• c∆∞·ªùi m√† l√¢u l·∫Øm r·ªìi em
                    m·ªõi ƒë∆∞·ª£c c·∫£m nh·∫≠n. Anh cho em s·ª± an to√†n v√† b√¨nh y√™n---ƒëi·ªÅu m√† em c·∫ßn nh·∫•t.
                </p>

                <p>
                    C·∫£m ∆°n anh v√¨ ƒë√£ lu√¥n ki√™n nh·∫´n, ·∫•m √°p, v√† che ch·ªü cho em. C·∫£m ∆°n anh ƒë√£ bao dung nh·ªØng th√≥i x·∫•u c·ªßa
                    em, lu√¥n kh√¥ng ƒë·ªÉ em bu·ªìn m·ªôt m√¨nh, chuy·ªán g√¨ c≈©ng c√πng em t√¨m c√°ch gi·∫£i quy·∫øt... m·∫∑c d√π c√≥ nh·ªØng
                    l√∫c nh√¨n anh ƒë√°ng gh√©t kh√¥ng ch·ªãu n·ªïi. C·∫£m ∆°n anh v√¨ ƒë√£ ƒë·∫øn qu·∫≠y ƒë·ª•c cu·ªôc s·ªëng bu·ªìn t·∫ª c·ªßa em, v√†
                    h∆°n h·∫øt---c·∫£m ∆°n v√¨ ƒë·∫øn gi·ªù v·∫´n n·∫Øm ch·∫∑t tay em kh√¥ng bu√¥ng.
                </p>

                <p>
                    Em tin m·ªôt ng√†y kh√¥ng xa, Noel s·∫Ω kh√¥ng c√≤n l√† c√¢u chuy·ªán qua m√†n h√¨nh n·ªØa, m√† s·∫Ω l√† nh·ªØng c√°i √¥m
                    g·∫ßn, l√† s·ª± b√¨nh y√™n khi c√≥ anh b√™n c·∫°nh.
                </p>

                <p>
                    Ch√∫c anh m·ªôt m√πa Gi√°ng sinh an l√†nh, ·∫•m √°p. Ch√∫c cho ch√∫ng m√¨nh ti·∫øp t·ª•c m·∫°nh m·∫Ω, y√™u th∆∞∆°ng v√† tin
                    t∆∞·ªüng.
                </p>

                <div class="signature">
                    Happy 5 months, my love.<br />
                    Em th∆∞∆°ng anh r·∫•t nhi·ªÅu. ‚ù§Ô∏è
                </div>

                <button class="arrow-button" onclick="goToGalaxy()" style="margin-top: 30px">
                    üí´ Xem V≈© Tr·ª• C·ªßa Ch√∫ng M√¨nh üí´
                </button>
            </div>
        </div>

        <!-- Page 2 - Galaxy -->
        <div class="page" id="galaxyPage">
            <div class="rotate-notice" id="rotateNotice" style="display: none;">
                <div class="rotate-icon">üì±‚ûúüì±</div>
                <div class="rotate-text">
                    Vui l√≤ng xoay ngang m√†n h√¨nh<br />
                    ƒë·ªÉ c√≥ tr·∫£i nghi·ªám t·ªët nh·∫•t ‚ú®
                </div>
            </div>
            
            <div class="galaxy-info">
                ‚ú® Milky Way Galaxy ‚ú®
                <div class="subtitle">V≈© tr·ª• c·ªßa t√¨nh y√™u ch√∫ng ta</div>
            </div>
            <canvas id="canvas"></canvas>
        </div>

        <!-- Music Control -->
        <div class="music-control" id="musicControl" onclick="toggleMusic()">üîä</div>

        <!-- Audio -->
        <audio id="bgMusic" loop preload="metadata">
            <source src="audios/nguyen-yeu.aac" type="audio/aac" />
        </audio>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
        <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
        <script>
            // ===== MUSIC CONTROL =====
            const music = document.getElementById('bgMusic')
            const musicControl = document.getElementById('musicControl')
            let isPlaying = false
            let audioContext = null

            function initAudio() {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)()
                }
                if (audioContext.state === 'suspended') {
                    audioContext.resume().catch(e => console.error('AudioContext resume failed:', e))
                }
            }

            function toggleMusic() {
                initAudio()
                if (isPlaying) {
                    music.pause()
                    isPlaying = false
                    musicControl.textContent = 'üîá'
                } else {
                    music.play()
                        .then(() => {
                            isPlaying = true
                            musicControl.textContent = 'üîä'
                        })
                        .catch(e => {
                            console.warn("Audio play failed:", e)
                            isPlaying = false
                        })
                }
            }

            // ===== HEARTS ANIMATION =====
            let heartCount = 0
            const maxHearts = 3
            let heartInterval
            let isScrolling = false
            let scrollTimeout
            const heartsContainer = document.getElementById('heartsContainer')

            function createHeart() {
                if (heartCount >= maxHearts || isScrolling) return

                const heart = document.createElement('div')
                heart.className = 'heart'
                const hearts = ['üíï', 'üíñ', 'üíó']
                heart.textContent = hearts[Math.floor(Math.random() * hearts.length)]
                heart.style.setProperty('--random-left', Math.random() * 100 + '%')
                heart.style.setProperty('--random-delay', Math.random() * 2 + 's')
                heartsContainer.appendChild(heart)

                heartCount++

                setTimeout(() => {
                    heart.remove()
                    heartCount--
                }, 5000)
            }

            function startHearts() {
                heartsContainer.classList.add('active')
                heartInterval = setInterval(createHeart, 3000)
            }

            function stopHearts() {
                clearInterval(heartInterval)
                heartsContainer.classList.remove('active')
            }

            function pauseHearts() {
                heartsContainer.classList.add('paused')
                isScrolling = true
            }

            function resumeHearts() {
                heartsContainer.classList.remove('paused')
                isScrolling = false
            }

            let scrollElements = [window, document.getElementById('letterContent')]
            scrollElements.forEach(element => {
                if (element) {
                    element.addEventListener('scroll', () => {
                        pauseHearts()
                        clearTimeout(scrollTimeout)
                        scrollTimeout = setTimeout(resumeHearts, 200)
                    }, { passive: true })
                }
            })

            setTimeout(startHearts, 1500)

            // ===== LETTER FUNCTIONS =====
            function showLetter() {
                document.getElementById('letterOverlay').classList.add('show')
                if (!isPlaying) {
                    toggleMusic()
                }
            }

            function openLetter() {
                const envelope = document.getElementById('envelope')
                const letterContent = document.getElementById('letterContent')

                envelope.classList.add('open')
                setTimeout(() => {
                    envelope.style.display = 'none'
                    letterContent.classList.add('show')
                    requestAnimationFrame(() => {
                        letterContent.scrollTop = 0
                        letterContent.style.WebkitOverflowScrolling = 'touch'
                    })
                }, 800)
            }

            // ===== TRANSITION TO GALAXY =====
            let galaxyInitialized = false

            function goToGalaxy() {
                document.getElementById('page1').classList.remove('active')
                document.getElementById('letterOverlay').classList.remove('show')
                stopHearts()

                setTimeout(() => {
                    document.getElementById('galaxyPage').classList.add('active')
                    if (!galaxyInitialized) {
                        galaxyInitialized = true
                        // Add a small delay to ensure the page is visible before initializing
                        setTimeout(() => {
                            initGalaxy()
                        }, 100)
                    }
                }, 100)
            }

            // ===== GALAXY VISUALIZATION =====
            let scene, camera, renderer, controls
            let planet, glow, rings = [], photoFrames = [], orbitingObjects = [], particles
            let shootingStars = []
            const imageUrls = [
                'images/galaxy/Picture1.jpg', 'images/galaxy/Picture2.jpg', 'images/galaxy/Picture3.jpg',
                'images/galaxy/Picture4.jpg', 'images/galaxy/Picture5.jpg', 'images/galaxy/Picture6.jpg',
                'images/galaxy/Picture7.jpg', 'images/galaxy/Picture8.jpg', 'images/galaxy/Picture9.jpg',
                'images/galaxy/Picture10.jpg', 'images/galaxy/Picture11.jpg', 'images/galaxy/Picture12.jpg',
                'images/galaxy/Picture13.jpg', 'images/galaxy/Picture14.jpg', 'images/galaxy/Picture15.jpg',
                'images/galaxy/Picture16.jpg', 'images/galaxy/Picture17.jpg', 'images/galaxy/Picture18.jpg',
                'images/galaxy/Picture19.jpg', 'images/galaxy/Picture20.jpg', 'images/galaxy/Picture21.jpg',
                'images/galaxy/Picture22.jpg', 'images/galaxy/Picture23.jpg', 'images/galaxy/Picture24.jpg',
                'images/galaxy/Picture25.jpg', 'images/galaxy/Picture26.jpg', 'images/galaxy/Picture27.jpg',
                'images/galaxy/Picture28.jpg'
            ]

            function initGalaxy() {
                console.log('Initializing galaxy...')
                const canvas = document.getElementById('canvas')
                
                if (!canvas) {
                    console.error('Canvas not found!')
                    return
                }
                
                scene = new THREE.Scene()

                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000)
                camera.position.z = 28

                renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true })
                renderer.setSize(window.innerWidth, window.innerHeight)
                renderer.setClearColor(0x0a0015, 1)
                
                console.log('Renderer initialized')

                controls = new THREE.OrbitControls(camera, renderer.domElement)
                controls.enableDamping = true
                controls.dampingFactor = 0.05
                controls.screenSpacePanning = false
                controls.minDistance = 5
                controls.maxDistance = 30
                controls.autoRotate = false
                controls.target.set(0, 0, 0)
                controls.update()
                
                console.log('Controls initialized')

                // Lights
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.5)
                scene.add(ambientLight)

                const pointLight1 = new THREE.PointLight(0xff69b4, 2, 100)
                pointLight1.position.set(10, 10, 10)
                scene.add(pointLight1)

                const pointLight2 = new THREE.PointLight(0xffb3d9, 1.5, 100)
                pointLight2.position.set(-10, -10, -10)
                scene.add(pointLight2)

                const pointLight3 = new THREE.PointLight(0xff1493, 1.8, 100)
                pointLight3.position.set(0, 15, 5)
                scene.add(pointLight3)

                // Central planet
                const planetGeometry = new THREE.SphereGeometry(3.5, 64, 64)
                const planetMaterial = new THREE.MeshPhongMaterial({
                    color: 0xffb3d9,
                    emissive: 0xff69b4,
                    emissiveIntensity: 0.5,
                    shininess: 150,
                    specular: 0xffffff
                })
                planet = new THREE.Mesh(planetGeometry, planetMaterial)
                scene.add(planet)

                // Glow
                const glowGeometry = new THREE.SphereGeometry(3.9, 32, 32)
                const glowMaterial = new THREE.MeshBasicMaterial({
                    color: 0xff69b4,
                    transparent: true,
                    opacity: 0.2,
                    side: THREE.BackSide
                })
                glow = new THREE.Mesh(glowGeometry, glowMaterial)
                scene.add(glow)

                // Rings
                for (let i = 0; i < 3; i++) {
                    const ringGeometry = new THREE.TorusGeometry(4.5 + i * 0.7, 0.1, 16, 100)
                    const ringMaterial = new THREE.MeshPhongMaterial({
                        color: new THREE.Color().setHSL(0.9 + i * 0.02, 0.8, 0.6),
                        emissive: new THREE.Color().setHSL(0.9 + i * 0.02, 1, 0.5),
                        emissiveIntensity: 0.6,
                        transparent: true,
                        opacity: 0.7 - i * 0.1
                    })
                    const ring = new THREE.Mesh(ringGeometry, ringMaterial)
                    ring.rotation.x = Math.PI / 2.5 + i * 0.1
                    ring.userData.rotationSpeed = 0.003 + i * 0.001
                    scene.add(ring)
                    rings.push(ring)
                }

                // Photo frames
                const textureLoader = new THREE.TextureLoader()
                for (let i = 0; i < 28; i++) {
                    const frameGroup = new THREE.Group()

                    const photoGeometry = new THREE.PlaneGeometry(3, 3)
                    const photoMaterial = new THREE.MeshBasicMaterial({
                        color: 0xffffff,
                        side: THREE.DoubleSide
                    })

                    if (imageUrls[i] && imageUrls[i].trim() !== '') {
                        textureLoader.load(imageUrls[i], function (texture) {
                            photoMaterial.map = texture
                            photoMaterial.needsUpdate = true
                        })
                    }

                    const photo = new THREE.Mesh(photoGeometry, photoMaterial)
                    frameGroup.add(photo)

                    const borderGeometry = new THREE.PlaneGeometry(3.4, 3.4)
                    const borderMaterial = new THREE.MeshPhongMaterial({
                        color: 0xff69b4,
                        emissive: 0xff1493,
                        emissiveIntensity: 0.6,
                        transparent: true,
                        opacity: 0.8
                    })
                    const border = new THREE.Mesh(borderGeometry, borderMaterial)
                    border.position.z = -0.05
                    frameGroup.add(border)

                    const haloGeometry = new THREE.PlaneGeometry(4, 4)
                    const haloMaterial = new THREE.MeshBasicMaterial({
                        color: 0xff69b4,
                        transparent: true,
                        opacity: 0.2,
                        side: THREE.DoubleSide
                    })
                    const halo = new THREE.Mesh(haloGeometry, haloMaterial)
                    halo.position.z = -0.1
                    frameGroup.add(halo)

                    const angle = (i / 28) * Math.PI * 2
                    const radius = 10 + (i % 3) * 2

                    frameGroup.userData = {
                        angle: angle,
                        radius: radius,
                        speed: 0.15 + (i % 4) * 0.05,
                        photo: photo,
                        border: border,
                        halo: halo,
                        index: i
                    }

                    scene.add(frameGroup)
                    photoFrames.push(frameGroup)
                }

                // Particles
                const particlesGeometry = new THREE.BufferGeometry()
                const particleCount = 3000
                const positions = new Float32Array(particleCount * 3)
                const colors = new Float32Array(particleCount * 3)
                const sizes = new Float32Array(particleCount)

                for (let i = 0; i < particleCount; i++) {
                    positions[i * 3] = (Math.random() - 0.5) * 100
                    positions[i * 3 + 1] = (Math.random() - 0.5) * 100
                    positions[i * 3 + 2] = (Math.random() - 0.5) * 100

                    const color = new THREE.Color()
                    color.setHSL(0.85 + Math.random() * 0.15, 0.8, 0.6)
                    colors[i * 3] = color.r
                    colors[i * 3 + 1] = color.g
                    colors[i * 3 + 2] = color.b

                    sizes[i] = Math.random() * 3
                }

                particlesGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3))
                particlesGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3))
                particlesGeometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1))

                const particlesMaterial = new THREE.PointsMaterial({
                    size: 0.2,
                    vertexColors: true,
                    transparent: true,
                    opacity: 0.8,
                    blending: THREE.AdditiveBlending
                })

                particles = new THREE.Points(particlesGeometry, particlesMaterial)
                scene.add(particles)

                // Orbiting objects
                for (let i = 0; i < 20; i++) {
                    const geometry = new THREE.OctahedronGeometry(0.3)
                    const hue = 0.85 + Math.random() * 0.15
                    const material = new THREE.MeshPhongMaterial({
                        color: new THREE.Color().setHSL(hue, 0.9, 0.6),
                        emissive: new THREE.Color().setHSL(hue, 1, 0.5),
                        emissiveIntensity: 0.8,
                        shininess: 150
                    })

                    const obj = new THREE.Mesh(geometry, material)

                    const angle = (i / 20) * Math.PI * 2
                    const radius = 6 + Math.random() * 3

                    obj.userData = {
                        angle: angle,
                        radius: radius,
                        speed: 0.3 + Math.random() * 0.4,
                        rotationSpeed: 0.02 + Math.random() * 0.03
                    }

                    scene.add(obj)
                    orbitingObjects.push(obj)
                }

                // Shooting stars
                initShootingStars()
                
                console.log('Galaxy initialization complete, starting animation')
                animate()
            }

            // Shooting stars system
            const MAX_STARS = 5
            const STAR_SPEED = 0.7
            const STAR_LENGTH = 15
            const SPAWN_INTERVAL = 50
            let lastSpawnTime = 0

            const starMaterial = new THREE.ShaderMaterial({
                uniforms: {
                    color: { value: new THREE.Color(0xffffff) },
                    opacity: { value: 1.0 },
                    time: { value: 0.0 },
                    length: { value: STAR_LENGTH }
                },
                vertexShader: `
                    uniform float time;
                    uniform float length;
                    varying vec3 vPosition;

                    void main() {
                        vPosition = position;
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                `,
                fragmentShader: `
                    uniform vec3 color;
                    uniform float opacity;
                    uniform float time;
                    uniform float length;
                    varying vec3 vPosition;

                    void main() {
                        float z = vPosition.z;
                        float normalizedZ = (z + length / 2.0) / length;
                        float tailFade = pow(normalizedZ, 4.0);
                        float sparkle = sin(time * 5.0) * 0.05 + 0.95;
                        float alpha = opacity * tailFade * sparkle;
                        vec3 finalColor = color + vec3(0.1, 0.1, 0.1) * normalizedZ;
                        gl_FragColor = vec4(finalColor, alpha);
                    }
                `,
                transparent: true,
                blending: THREE.AdditiveBlending,
                depthWrite: false
            })

            function initShootingStars() {
                // Initialization handled in animate loop
            }

            function createShootingStar() {
                const pathPoints = []
                const range = 50

                const startX = range + Math.random() * 20
                const startY = (Math.random() - 0.5) * range
                const startZ = -range - Math.random() * 20

                const endX = -range - Math.random() * 20
                const endY = (Math.random() - 0.5) * range
                const endZ = range + Math.random() * 20

                pathPoints.push(new THREE.Vector3(0, 0, -STAR_LENGTH / 2))
                pathPoints.push(new THREE.Vector3(0, 0, STAR_LENGTH / 2))

                const curve = new THREE.CatmullRomCurve3(pathPoints)
                const geometry = new THREE.TubeGeometry(curve, 1, 0.3, 8, false)

                const star = new THREE.Mesh(geometry, starMaterial.clone())

                const direction = new THREE.Vector3()
                    .subVectors(new THREE.Vector3(endX, endY, endZ), new THREE.Vector3(startX, startY, startZ))
                    .normalize()
                const axis = new THREE.Vector3(0, 0, 1)
                const quaternion = new THREE.Quaternion().setFromUnitVectors(axis, direction)
                star.rotation.setFromQuaternion(quaternion)

                star.position.set(startX, startY, startZ)

                star.userData = {
                    velocity: new THREE.Vector3(endX - startX, endY - startY, endZ - startZ)
                        .normalize()
                        .multiplyScalar(STAR_SPEED)
                }

                scene.add(star)
                shootingStars.push(star)
            }

            function updateShootingStars(delta) {
                if (Date.now() - lastSpawnTime > SPAWN_INTERVAL && shootingStars.length < MAX_STARS) {
                    createShootingStar()
                    lastSpawnTime = Date.now()
                }

                const starsToRemove = []

                shootingStars.forEach((star, index) => {
                    if (star.material && star.material.uniforms && star.material.uniforms.time) {
                        star.material.uniforms.time.value = (Date.now() / 1000) * 0.5
                    }

                    star.position.add(star.userData.velocity.clone().multiplyScalar(delta))

                    if (
                        star.position.x < -60 || star.position.x > 60 ||
                        star.position.y < -60 || star.position.y > 60 ||
                        star.position.z < -60 || star.position.z > 60
                    ) {
                        starsToRemove.push(index)
                    }
                })

                for (let i = starsToRemove.length - 1; i >= 0; i--) {
                    const index = starsToRemove[i]
                    const star = shootingStars[index]

                    if (star.geometry) star.geometry.dispose()
                    if (star.material) {
                        star.material.dispose()
                    }

                    scene.remove(star)
                    shootingStars.splice(index, 1)
                }
            }

            // Animation loop
            let time = 0
            const clock = new THREE.Clock()
            let animationRunning = false

            function animate() {
                if (!galaxyInitialized || !scene || !renderer || !camera) {
                    console.log('Animation stopped - not initialized')
                    return
                }
                
                if (!animationRunning) {
                    console.log('Animation started')
                    animationRunning = true
                }
                
                requestAnimationFrame(animate)
                const delta = clock.getDelta()
                time += delta

                planet.rotation.y += 0.005
                glow.rotation.y -= 0.003
                glow.material.opacity = 0.2 + Math.sin(time * 2) * 0.1

                rings.forEach(ring => {
                    ring.rotation.z += ring.userData.rotationSpeed
                })

                photoFrames.forEach(frame => {
                    frame.userData.angle += frame.userData.speed * 0.008

                    const x = Math.cos(frame.userData.angle) * frame.userData.radius
                    const z = Math.sin(frame.userData.angle) * frame.userData.radius
                    const y = Math.sin(time * 1.5 + frame.userData.index * 0.5) * 2

                    frame.position.set(x, y, z)
                    frame.lookAt(planet.position)

                    frame.userData.halo.material.opacity = 0.2 + Math.sin(time * 3 + frame.userData.index) * 0.15
                    frame.userData.border.material.emissiveIntensity = 0.6 + Math.sin(time * 4 + frame.userData.index) * 0.3
                })

                orbitingObjects.forEach(obj => {
                    obj.userData.angle += obj.userData.speed * 0.01

                    obj.position.x = Math.cos(obj.userData.angle) * obj.userData.radius
                    obj.position.z = Math.sin(obj.userData.angle) * obj.userData.radius
                    obj.position.y = Math.sin(time * 2 + obj.userData.angle) * 2

                    obj.rotation.x += obj.userData.rotationSpeed
                    obj.rotation.y += obj.userData.rotationSpeed
                })

                particles.rotation.y += 0.0003
                const positionsAttr = particles.geometry.attributes.position.array
                for (let i = 0; i < positionsAttr.length; i += 3) {
                    positionsAttr[i + 1] += Math.sin(time + i) * 0.005
                }
                particles.geometry.attributes.position.needsUpdate = true

                updateShootingStars(delta * 60)

                controls.update()
                renderer.render(scene, camera)
            }

            // Window resize
            window.addEventListener('resize', () => {
                if (galaxyInitialized) {
                    camera.aspect = window.innerWidth / window.innerHeight
                    camera.updateProjectionMatrix()
                    renderer.setSize(window.innerWidth, window.innerHeight)
                    controls.update()
                }
            })

            // Visibility change
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    if (isPlaying) music.pause()
                    pauseHearts()
                } else {
                    if (isPlaying) music.play().catch(() => {})
                    resumeHearts()
                }
            })
        </script>
    </body>
</html>