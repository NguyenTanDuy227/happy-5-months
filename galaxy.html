<!DOCTYPE html>
<html lang="vi">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link type="image/png" sizes="16x16" rel="icon" href="favicons/icons8-favorite-windows-11-color-16.png" />
        <link type="image/png" sizes="32x32" rel="icon" href="favicons/icons8-favorite-windows-11-color-32.png" />
        <link type="image/png" sizes="96x96" rel="icon" href="favicons/icons8-favorite-windows-11-color-96.png" />
        <title>H√†nh Tinh L√£ng M·∫°n</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                overflow: hidden;
                background: #0a0015;
                font-family: 'Arial', sans-serif;
            }

            #canvas {
                display: block;
                width: 100%;
                height: 100vh;
            }

            .info {
                position: absolute;
                top: 30px;
                left: 50%;
                transform: translateX(-50%);
                color: #ff69b4;
                text-align: center;
                font-size: 32px;
                font-weight: bold;
                text-shadow: 0 0 20px rgba(255, 105, 180, 0.8), 0 0 40px rgba(255, 105, 180, 0.5);
                z-index: 10;
                pointer-events: none;
                animation: glow 2s ease-in-out infinite;
            }

            @keyframes glow {
                0%,
                100% {
                    text-shadow: 0 0 20px rgba(255, 105, 180, 0.8), 0 0 40px rgba(255, 105, 180, 0.5);
                }
                50% {
                    text-shadow: 0 0 30px rgba(255, 105, 180, 1), 0 0 60px rgba(255, 105, 180, 0.8);
                }
            }

            .subtitle {
                font-size: 16px;
                font-weight: normal;
                margin-top: 10px;
                color: #ffb3d9;
            }

            .rotate-notice {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(10, 0, 21, 0.95);
                z-index: 9999;
                justify-content: center;
                align-items: center;
                flex-direction: column;
            }

            .rotate-icon {
                font-size: 80px;
                margin-bottom: 20px;
                animation: rotate-animation 2s ease-in-out infinite;
            }

            @keyframes rotate-animation {
                0%,
                100% {
                    transform: rotate(0deg);
                }
                50% {
                    transform: rotate(90deg);
                }
            }

            .rotate-text {
                color: #ff69b4;
                font-size: 20px;
                text-align: center;
                padding: 0 20px;
                text-shadow: 0 0 10px rgba(255, 105, 180, 0.5);
            }

            @media (max-width: 768px) and (orientation: portrait) {
                .rotate-notice {
                    display: flex;
                }
            }

            .music-controls {
                position: absolute;
                bottom: 30px; /* ƒê·∫∑t ·ªü d∆∞·ªõi c√πng */
                left: 50%;
                transform: translateX(-50%);
                z-index: 10;
                text-align: center;
            }

            #music-toggle-btn {
                background: rgba(255, 105, 180, 0.7);
                color: #0a0015;
                border: 2px solid #ffb3d9;
                padding: 10px 20px;
                font-size: 16px;
                font-weight: bold;
                border-radius: 25px;
                cursor: pointer;
                outline: none;
                transition: all 0.3s ease;
                box-shadow: 0 0 15px rgba(255, 105, 180, 0.5);
            }

            #music-toggle-btn:hover {
                background: #ff69b4;
                box-shadow: 0 0 20px #ff69b4;
                transform: scale(1.05);
            }
        </style>
    </head>
    <body>
        <div class="rotate-notice">
            <div class="rotate-icon">üì±‚ûúüì±</div>
            <div class="rotate-text">
                Vui l√≤ng xoay ngang m√†n h√¨nh<br />
                ƒë·ªÉ c√≥ tr·∫£i nghi·ªám t·ªët nh·∫•t ‚ú®
            </div>
        </div>

        <div class="info">
            ‚ú® Milky Way Galaxy ‚ú®
            <div class="subtitle">V≈© tr·ª• c·ªßa t√¨nh y√™u ch√∫ng ta</div>
        </div>

        <div class="music-controls">
            <audio id="background-music" loop>
                <source src="audios/Nguy·ªán Y√™u.mp3" type="audio/mp3" />
                Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ph·∫ßn t·ª≠ audio.
            </audio>
            <button id="music-toggle-btn">üéµ T·∫Øt Nh·∫°c</button>
        </div>

        <canvas id="canvas"></canvas>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
        <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
        <script>
            // ===== TH√äM ƒê∆Ø·ªúNG D·∫™N ·∫¢NH C·ª¶A B·∫†N ·ªû ƒê√ÇY (GI·ªÆ NGUY√äN) =====
            const imageUrls = [
                'images/galaxy/Picture1.jpg', // ·∫¢nh 1
                'images/galaxy/Picture2.jpg', // ·∫¢nh 2
                'images/galaxy/Picture3.jpg', // ·∫¢nh 3
                'images/galaxy/Picture4.jpg', // ·∫¢nh 4
                'images/galaxy/Picture5.jpg', // ·∫¢nh 5
                'images/galaxy/Picture6.jpg', // ·∫¢nh 6
                'images/galaxy/Picture7.jpg', // ·∫¢nh 7
                'images/galaxy/Picture8.jpg', // ·∫¢nh 8
                'images/galaxy/Picture9.jpg', // ·∫¢nh 9
                'images/galaxy/Picture10.jpg', // ·∫¢nh 10
                'images/galaxy/Picture11.jpg', // ·∫¢nh 11
                'images/galaxy/Picture12.jpg', // ·∫¢nh 12
                'images/galaxy/Picture13.jpg', // ·∫¢nh 13
                'images/galaxy/Picture14.jpg', // ·∫¢nh 14
                'images/galaxy/Picture15.jpg', // ·∫¢nh 15
                'images/galaxy/Picture16.jpg', // ·∫¢nh 16
                'images/galaxy/Picture17.jpg', // ·∫¢nh 17
                'images/galaxy/Picture18.jpg', // ·∫¢nh 18
                'images/galaxy/Picture19.jpg', // ·∫¢nh 19
                'images/galaxy/Picture20.jpg', // ·∫¢nh 20
                'images/galaxy/Picture21.jpg', // ·∫¢nh 21
                'images/galaxy/Picture22.jpg', // ·∫¢nh 22
                'images/galaxy/Picture23.jpg', // ·∫¢nh 23
                'images/galaxy/Picture24.jpg', // ·∫¢nh 24
                'images/galaxy/Picture25.jpg', // ·∫¢nh 25
                'images/galaxy/Picture26.jpg', // ·∫¢nh 26
                'images/galaxy/Picture27.jpg', // ·∫¢nh 27
                'images/galaxy/Picture28.jpg' // ·∫¢nh 28
            ]
            // ===========================================

            const canvas = document.getElementById('canvas')
            const scene = new THREE.Scene()

            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000)
            camera.position.z = 28

            const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true })
            renderer.setSize(window.innerWidth, window.innerHeight)
            renderer.setClearColor(0x0a0015, 1)

            // ‚ú® KH·ªûI T·∫†O ORBITCONTROLS (cho ph√©p qu·∫πt/vu·ªët ƒë·ªÉ quay) ‚ú®
            const controls = new THREE.OrbitControls(camera, renderer.domElement)
            controls.enableDamping = true // Cho chuy·ªÉn ƒë·ªông m∆∞·ª£t m√†
            controls.dampingFactor = 0.05
            controls.screenSpacePanning = false
            controls.minDistance = 5 // Zoom t·ªëi thi·ªÉu
            controls.maxDistance = 30 // Zoom t·ªëi ƒëa
            controls.autoRotate = false // T·∫Øt t·ª± ƒë·ªông quay
            controls.target.set(0, 0, 0) // ƒê·∫∑t m·ª•c ti√™u xoay l√† trung t√¢m (h√†nh tinh)
            controls.update()
            // ‚ú® K·∫æT TH√öC KH·ªûI T·∫†O ORBITCONTROLS ‚ú®

            // √Ånh s√°ng
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5)
            scene.add(ambientLight)

            const pointLight1 = new THREE.PointLight(0xff69b4, 2, 100)
            pointLight1.position.set(10, 10, 10)
            scene.add(pointLight1)

            const pointLight2 = new THREE.PointLight(0xffb3d9, 1.5, 100)
            pointLight2.position.set(-10, -10, -10)
            scene.add(pointLight2)

            const pointLight3 = new THREE.PointLight(0xff1493, 1.8, 100)
            pointLight3.position.set(0, 15, 5)
            scene.add(pointLight3)

            // H√†nh tinh trung t√¢m
            const planetGeometry = new THREE.SphereGeometry(3.5, 64, 64)
            const planetMaterial = new THREE.MeshPhongMaterial({
                color: 0xffb3d9,
                emissive: 0xff69b4,
                emissiveIntensity: 0.5,
                shininess: 150,
                specular: 0xffffff
            })
            const planet = new THREE.Mesh(planetGeometry, planetMaterial)
            scene.add(planet)

            // V√≤ng s√°ng xung quanh h√†nh tinh
            const glowGeometry = new THREE.SphereGeometry(3.9, 32, 32)
            const glowMaterial = new THREE.MeshBasicMaterial({
                color: 0xff69b4,
                transparent: true,
                opacity: 0.2,
                side: THREE.BackSide
            })
            const glow = new THREE.Mesh(glowGeometry, glowMaterial)
            scene.add(glow)

            // C√°c v√≤ng quang
            const rings = []
            for (let i = 0; i < 3; i++) {
                const ringGeometry = new THREE.TorusGeometry(4.5 + i * 0.7, 0.1, 16, 100)
                const ringMaterial = new THREE.MeshPhongMaterial({
                    color: new THREE.Color().setHSL(0.9 + i * 0.02, 0.8, 0.6),
                    emissive: new THREE.Color().setHSL(0.9 + i * 0.02, 1, 0.5),
                    emissiveIntensity: 0.6,
                    transparent: true,
                    opacity: 0.7 - i * 0.1
                })
                const ring = new THREE.Mesh(ringGeometry, ringMaterial)
                ring.rotation.x = Math.PI / 2.5 + i * 0.1
                ring.userData.rotationSpeed = 0.003 + i * 0.001
                scene.add(ring)
                rings.push(ring)
            }

            // T·∫°o 28 khung h√¨nh
            const photoFrames = []
            const textureLoader = new THREE.TextureLoader()

            function createPhotoFrame(index, imageUrl) {
                const frameGroup = new THREE.Group()

                // M·∫∑t ph·∫≥ng cho ·∫£nh
                const photoGeometry = new THREE.PlaneGeometry(3, 3)
                const photoMaterial = new THREE.MeshBasicMaterial({
                    color: 0xffffff,
                    side: THREE.DoubleSide
                })

                // Load ·∫£nh n·∫øu c√≥ URL
                if (imageUrl && imageUrl.trim() !== '') {
                    textureLoader.load(imageUrl, function (texture) {
                        photoMaterial.map = texture
                        photoMaterial.needsUpdate = true
                    })
                }

                const photo = new THREE.Mesh(photoGeometry, photoMaterial)
                frameGroup.add(photo)

                // Vi·ªÅn khung s√°ng
                const borderGeometry = new THREE.PlaneGeometry(3.4, 3.4)
                const borderMaterial = new THREE.MeshPhongMaterial({
                    color: 0xff69b4,
                    emissive: 0xff1493,
                    emissiveIntensity: 0.6,
                    transparent: true,
                    opacity: 0.8
                })
                const border = new THREE.Mesh(borderGeometry, borderMaterial)
                border.position.z = -0.05
                frameGroup.add(border)

                // H√†o quang
                const haloGeometry = new THREE.PlaneGeometry(4, 4)
                const haloMaterial = new THREE.MeshBasicMaterial({
                    color: 0xff69b4,
                    transparent: true,
                    opacity: 0.2,
                    side: THREE.DoubleSide
                })
                const halo = new THREE.Mesh(haloGeometry, haloMaterial)
                halo.position.z = -0.1
                frameGroup.add(halo)

                // V·ªã tr√≠ qu·ªπ ƒë·∫°o
                const angle = (index / 28) * Math.PI * 2
                const radius = 10 + (index % 3) * 2 // TƒÉng b√°n k√≠nh qu·ªπ ƒë·∫°o

                frameGroup.userData = {
                    angle: angle,
                    radius: radius,
                    speed: 0.15 + (index % 4) * 0.05,
                    photo: photo,
                    border: border,
                    halo: halo,
                    index: index
                }

                scene.add(frameGroup)
                photoFrames.push(frameGroup)

                return frameGroup
            }

            // T·∫°o t·∫•t c·∫£ 28 khung h√¨nh
            for (let i = 0; i < 28; i++) {
                createPhotoFrame(i, imageUrls[i])
            }

            // H·∫°t s√°ng
            const particlesGeometry = new THREE.BufferGeometry()
            const particleCount = 3000
            const positions = new Float32Array(particleCount * 3)
            const colors = new Float32Array(particleCount * 3)
            const sizes = new Float32Array(particleCount)

            for (let i = 0; i < particleCount; i++) {
                positions[i * 3] = (Math.random() - 0.5) * 100
                positions[i * 3 + 1] = (Math.random() - 0.5) * 100
                positions[i * 3 + 2] = (Math.random() - 0.5) * 100

                const color = new THREE.Color()
                color.setHSL(0.85 + Math.random() * 0.15, 0.8, 0.6)
                colors[i * 3] = color.r
                colors[i * 3 + 1] = color.g
                colors[i * 3 + 2] = color.b

                sizes[i] = Math.random() * 3
            }

            particlesGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3))
            particlesGeometry.setAttribute('color', new THREE.BufferAttribute(colors, 3))
            particlesGeometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1))

            const particlesMaterial = new THREE.PointsMaterial({
                size: 0.2,
                vertexColors: true,
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending
            })

            const particles = new THREE.Points(particlesGeometry, particlesMaterial)
            scene.add(particles)

            // C√°c v·∫≠t th·ªÉ ph√°t s√°ng
            const orbitingObjects = []
            for (let i = 0; i < 20; i++) {
                const geometry = new THREE.OctahedronGeometry(0.3)
                const hue = 0.85 + Math.random() * 0.15
                const material = new THREE.MeshPhongMaterial({
                    color: new THREE.Color().setHSL(hue, 0.9, 0.6),
                    emissive: new THREE.Color().setHSL(hue, 1, 0.5),
                    emissiveIntensity: 0.8,
                    shininess: 150
                })

                const obj = new THREE.Mesh(geometry, material)

                const angle = (i / 20) * Math.PI * 2
                const radius = 6 + Math.random() * 3

                obj.userData = {
                    angle: angle,
                    radius: radius,
                    speed: 0.3 + Math.random() * 0.4,
                    rotationSpeed: 0.02 + Math.random() * 0.03
                }

                scene.add(obj)
                orbitingObjects.push(obj)
            }

            // ----------------------------------------------------
            // ‚ú® C·∫¢I TI·∫æN HI·ªÜU ·ª®NG SAO BƒÇNG M√ÄU TR·∫ÆNG ‚ú®
            // ----------------------------------------------------

            const shootingStars = []
            const MAX_STARS = 5
            const STAR_SPEED = 0.7 // TƒÉng t·ªëc ƒë·ªô l√™n m·ªôt ch√∫t
            const STAR_LENGTH = 15 // TƒÉng chi·ªÅu d√†i qu·ªπ ƒë·∫°o ƒë·ªÉ v·ªát d√†i h∆°n
            const SPAWN_INTERVAL = 50
            let lastSpawnTime = 0

            // ShaderMaterial m·ªõi cho sao bƒÉng (t·∫°o hi·ªáu ·ª©ng ph√°t s√°ng, ƒëu√¥i m·ªù v√† l·∫•p l√°nh)
            const starMaterial = new THREE.ShaderMaterial({
                uniforms: {
                    color: { value: new THREE.Color(0xffffff) },
                    opacity: { value: 1.0 },
                    time: { value: 0.0 },
                    length: { value: STAR_LENGTH }
                },
                vertexShader: `
        uniform float time;
        uniform float length;
        varying vec3 vPosition;

        void main() {
            vPosition = position;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
    `,
                fragmentShader: `
        uniform vec3 color;
        uniform float opacity;
        uniform float time;
        uniform float length;
        varying vec3 vPosition;

        void main() {
            // L·∫•y v·ªã tr√≠ Z (d·ªçc theo tr·ª•c sao bƒÉng)
            float z = vPosition.z;
            
            // Chu·∫©n h√≥a v·ªã tr√≠ Z t·ª´ 0 (ƒëu√¥i) ƒë·∫øn 1 (ƒë·∫ßu)
            float normalizedZ = (z + length / 2.0) / length; 
            
            // === C·∫¢I TI·∫æN: T·∫°o ƒëu√¥i sao bƒÉng m·ªÅm m·∫°i v√† d√†i h∆°n ===
            // S·ª≠ d·ª•ng h√†m pow v·ªõi s·ªë m≈© l·ªõn ƒë·ªÉ t·∫°o ƒëu√¥i d√†i, sau ƒë√≥ nh√¢n v·ªõi m·ªôt h√†m sine ƒë·ªÉ th√™m hi·ªáu ·ª©ng nh·∫•p nh√°y
            float tailFade = pow(normalizedZ, 4.0); // TƒÉng l≈©y th·ª´a l√™n 4.0 ƒë·ªÉ ƒëu√¥i d√†i v√† m·ªù h∆°n
            
            // Hi·ªáu ·ª©ng l·∫•p l√°nh nh·∫π theo th·ªùi gian (ch·ªâ ·∫£nh h∆∞·ªüng ƒë·∫øn ƒë·ªô s√°ng chung)
            float sparkle = sin(time * 5.0) * 0.05 + 0.95; // Nh·∫•p nh√°y nh·∫π 
            
            // √Åp d·ª•ng ƒë·ªô m·ªù c·ªßa ƒëu√¥i v√† hi·ªáu ·ª©ng l·∫•p l√°nh
            float alpha = opacity * tailFade * sparkle;
            
            // TƒÉng c∆∞·ªùng ƒë·ªô s√°ng ·ªü ph·∫ßn ƒë·∫ßu (t√πy ch·ªçn)
            vec3 finalColor = color + vec3(0.1, 0.1, 0.1) * normalizedZ; 

            gl_FragColor = vec4(finalColor, alpha);
        }
    `,
                transparent: true,
                blending: THREE.AdditiveBlending,
                depthWrite: false
            })

            function createShootingStar() {
                const pathPoints = []

                // TƒÉng bi√™n ƒë·ªô ng·∫´u nhi√™n ƒë·ªÉ sao bƒÉng xu·∫•t hi·ªán ·ªü c√°c v·ªã tr√≠ r·ªông h∆°n
                const range = 50

                // ƒêi·ªÉm b·∫Øt ƒë·∫ßu (xa h∆°n)
                const startX = range + Math.random() * 20
                const startY = (Math.random() - 0.5) * range
                const startZ = -range - Math.random() * 20

                // ƒêi·ªÉm k·∫øt th√∫c (g·∫ßn h∆°n)
                const endX = -range - Math.random() * 20
                const endY = (Math.random() - 0.5) * range
                const endZ = range + Math.random() * 20

                // T·∫°o 2 ƒëi·ªÉm ƒë·ªÉ ƒë·ªãnh h√¨nh ƒë∆∞·ªùng ƒëi th·∫≥ng c·ªßa TubeGeometry
                pathPoints.push(new THREE.Vector3(0, 0, -STAR_LENGTH / 2))
                pathPoints.push(new THREE.Vector3(0, 0, STAR_LENGTH / 2))

                const curve = new THREE.CatmullRomCurve3(pathPoints)

                // TƒÉng radius cho v·ªát d√†y h∆°n
                const geometry = new THREE.TubeGeometry(curve, 1, 0.3, 8, false) // TƒÉng b√°n k√≠nh v·ªát l√™n 0.3

                const star = new THREE.Mesh(geometry, starMaterial.clone())

                // T·∫°o ma tr·∫≠n xoay ƒë·ªÉ ƒë·ªãnh h∆∞·ªõng sao bƒÉng
                const direction = new THREE.Vector3()
                    .subVectors(new THREE.Vector3(endX, endY, endZ), new THREE.Vector3(startX, startY, startZ))
                    .normalize()
                const axis = new THREE.Vector3(0, 0, 1)
                const quaternion = new THREE.Quaternion().setFromUnitVectors(axis, direction)
                star.rotation.setFromQuaternion(quaternion)

                // ƒê·∫∑t v·ªã tr√≠ ban ƒë·∫ßu
                star.position.set(startX, startY, startZ)

                star.userData = {
                    velocity: new THREE.Vector3(endX - startX, endY - startY, endZ - startZ)
                        .normalize()
                        .multiplyScalar(STAR_SPEED)
                }

                scene.add(star)
                shootingStars.push(star)
            }

            function updateShootingStars(delta) {
                // 1. T·∫†O SAO BƒÇNG M·ªöI: Ch·ªâ t·∫°o khi s·ªë l∆∞·ª£ng √≠t h∆°n MAX_STARS v√† ƒë·ªß th·ªùi gian ch·ªù
                if (Date.now() - lastSpawnTime > SPAWN_INTERVAL && shootingStars.length < MAX_STARS) {
                    createShootingStar()
                    lastSpawnTime = Date.now()
                }

                const starsToRemove = []

                shootingStars.forEach((star, index) => {
                    // C·∫≠p nh·∫≠t uniform time cho hi·ªáu ·ª©ng nh·∫•p nh√°y c·ªßa Shader
                    if (star.material && star.material.uniforms && star.material.uniforms.time) {
                        star.material.uniforms.time.value = (Date.now() / 1000) * 0.5
                    }

                    // Di chuy·ªÉn sao bƒÉng
                    star.position.add(star.userData.velocity.clone().multiplyScalar(delta))

                    // ** ƒêI·ªÄU CH·ªàNH CH·ªà D·ª∞A TR√äN V·ªä TR√ç **
                    // Ki·ªÉm tra n·∫øu sao bƒÉng ƒë√£ ƒëi xa kh·ªèi m√†n h√¨nh
                    // Gi·∫£ ƒë·ªãnh ƒë√£ bay qua t·∫ßm nh√¨n (-50 ƒë·∫øn 50)
                    // Ch√∫ng ta n√™n s·ª≠ d·ª•ng m·ªôt bi√™n l·ªõn h∆°n m·ªôt ch√∫t ƒë·ªÉ ch·∫Øc ch·∫Øn n√≥ ƒë√£ ra ngo√†i
                    if (
                        star.position.x < -60 || // TƒÉng bi√™n l√™n 60 (Ban ƒë·∫ßu l√† 40)
                        star.position.x > 60 ||
                        star.position.y < -60 ||
                        star.position.y > 60 ||
                        star.position.z < -60 ||
                        star.position.z > 60
                    ) {
                        starsToRemove.push(index)
                    }

                    // ** LO·∫†I B·ªé logic t√≠nh to√°n life v√† opacity m·ªù d·∫ßn **
                    // V√¨ ch√∫ng ta mu·ªën sao bƒÉng bay ngang qua v√† ch·ªâ b·ªã x√≥a khi ra kh·ªèi t·∫ßm nh√¨n,
                    // vi·ªác t√≠nh to√°n life c·ªë ƒë·ªãnh kh√¥ng c√≤n c·∫ßn thi·∫øt.
                })

                // 2. X√ìA C√ÅC SAO BƒÇNG ƒê√É BAY XONG (ƒê√£ bao g·ªìm gi·∫£i ph√≥ng b·ªô nh·ªõ)
                for (let i = starsToRemove.length - 1; i >= 0; i--) {
                    const index = starsToRemove[i]
                    const star = shootingStars[index]

                    // ** QUAN TR·ªåNG: Gi·∫£i ph√≥ng t√†i nguy√™n ƒë·ªÉ tr√°nh r√≤ r·ªâ b·ªô nh·ªõ **
                    if (star.geometry) star.geometry.dispose()
                    if (star.material) {
                        star.material.uniforms.color.value = null
                        star.material.uniforms.opacity.value = null
                        star.material.uniforms.time.value = null
                        star.material.uniforms.length.value = null
                        star.material.dispose()
                    }

                    scene.remove(star)
                    shootingStars.splice(index, 1)
                }
            }

            // ----------------------------------------------------
            // ‚ú® K·∫æT TH√öC HI·ªÜU ·ª®NG SAO BƒÇNG M√ÄU TR·∫ÆNG ‚ú®
            // ----------------------------------------------------

            // Animation
            let time = 0
            const clock = new THREE.Clock() // ƒê·ªìng h·ªì ƒë·ªÉ t√≠nh to√°n delta time

            function animate() {
                requestAnimationFrame(animate)
                const delta = clock.getDelta() // L·∫•y th·ªùi gian tr√¥i qua k·ªÉ t·ª´ khung h√¨nh tr∆∞·ªõc
                time += delta

                // Xoay h√†nh tinh
                planet.rotation.y += 0.005
                glow.rotation.y -= 0.003
                glow.material.opacity = 0.2 + Math.sin(time * 2) * 0.1

                // Xoay c√°c v√≤ng quang
                rings.forEach(ring => {
                    ring.rotation.z += ring.userData.rotationSpeed
                })

                // Di chuy·ªÉn 28 khung h√¨nh
                photoFrames.forEach(frame => {
                    frame.userData.angle += frame.userData.speed * 0.008

                    const x = Math.cos(frame.userData.angle) * frame.userData.radius
                    const z = Math.sin(frame.userData.angle) * frame.userData.radius
                    const y = Math.sin(time * 1.5 + frame.userData.index * 0.5) * 2

                    frame.position.set(x, y, z)
                    frame.lookAt(planet.position)

                    // Hi·ªáu ·ª©ng nh·∫•p nh√°y
                    frame.userData.halo.material.opacity = 0.2 + Math.sin(time * 3 + frame.userData.index) * 0.15
                    frame.userData.border.material.emissiveIntensity =
                        0.6 + Math.sin(time * 4 + frame.userData.index) * 0.3
                })

                // Di chuy·ªÉn c√°c v·∫≠t th·ªÉ ph√°t s√°ng
                orbitingObjects.forEach(obj => {
                    obj.userData.angle += obj.userData.speed * 0.01

                    obj.position.x = Math.cos(obj.userData.angle) * obj.userData.radius
                    obj.position.z = Math.sin(obj.userData.angle) * obj.userData.radius
                    obj.position.y = Math.sin(time * 2 + obj.userData.angle) * 2

                    obj.rotation.x += obj.userData.rotationSpeed
                    obj.rotation.y += obj.userData.rotationSpeed
                })

                // Xoay h·∫°t s√°ng
                particles.rotation.y += 0.0003
                const positionsAttr = particles.geometry.attributes.position.array
                for (let i = 0; i < positionsAttr.length; i += 3) {
                    positionsAttr[i + 1] += Math.sin(time + i) * 0.005 // Gi·∫£m ƒë·ªô rung
                }
                particles.geometry.attributes.position.needsUpdate = true

                // Di chuy·ªÉn √°nh s√°ng
                pointLight1.position.x = Math.cos(time * 0.5) * 15
                pointLight1.position.z = Math.sin(time * 0.5) * 15

                pointLight2.position.x = Math.cos(time * 0.7 + Math.PI) * 12
                pointLight2.position.z = Math.sin(time * 0.7 + Math.PI) * 12

                pointLight3.position.x = Math.sin(time * 0.3) * 10
                pointLight3.position.z = Math.cos(time * 0.3) * 10

                // ‚ú® G·ªåI H√ÄM C·∫¨P NH·∫¨T SAO BƒÇNG ‚ú®
                updateShootingStars(delta * 60) // Nh√¢n delta v·ªõi h·ªá s·ªë ƒë·ªÉ c√≥ t·ªëc ƒë·ªô h·ª£p l√Ω
                // ----------------------------------

                // ‚ú® C·∫¨P NH·∫¨T ORBITCONTROLS ‚ú®
                controls.update()

                renderer.render(scene, camera)
            }

            // X·ª≠ l√Ω resize
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight
                camera.updateProjectionMatrix()
                renderer.setSize(window.innerWidth, window.innerHeight)
                // C·∫≠p nh·∫≠t controls sau khi resize
                controls.update()
            })

            animate()

            const audio = document.getElementById('background-music')
            const toggleBtn = document.getElementById('music-toggle-btn')
            let isPlaying = false // Ban ƒë·∫ßu ƒë·∫∑t l√† false, ch·ªù t∆∞∆°ng t√°c
            let hasInteracted = false // Bi·∫øn c·ªù ƒë·ªÉ ki·ªÉm tra ƒë√£ t∆∞∆°ng t√°c l·∫ßn ƒë·∫ßu ch∆∞a

            // H√†m ph√°t nh·∫°c
            function playAudio() {
                audio
                    .play()
                    .then(() => {
                        isPlaying = true
                        toggleBtn.textContent = 'üéµ T·∫Øt Nh·∫°c'
                    })
                    .catch(error => {
                        console.error('L·ªói khi ph√°t nh·∫°c:', error)
                        // N·∫øu ph√°t kh√¥ng th√†nh c√¥ng (v√≠ d·ª•: tr√¨nh duy·ªát ch·∫∑n), gi·ªØ n√∫t l√† B·∫≠t Nh·∫°c
                        isPlaying = false
                        toggleBtn.textContent = 'üé∂ B·∫≠t Nh·∫°c'
                    })
            }

            // H√†m t·∫°m d·ª´ng nh·∫°c
            function pauseAudio() {
                audio.pause()
                isPlaying = false
                toggleBtn.textContent = 'üé∂ B·∫≠t Nh·∫°c'
            }

            // H√†m x·ª≠ l√Ω t∆∞∆°ng t√°c l·∫ßn ƒë·∫ßu
            function handleFirstInteraction() {
                if (!hasInteracted) {
                    hasInteracted = true
                    playAudio()

                    // Lo·∫°i b·ªè c√°c l·∫Øng nghe s·ª± ki·ªán sau khi ƒë√£ ph√°t nh·∫°c th√†nh c√¥ng
                    document.removeEventListener('click', handleFirstInteraction)
                    document.removeEventListener('touchstart', handleFirstInteraction)
                    document.removeEventListener('keydown', handleFirstInteraction)
                }
            }

            // Th√™m l·∫Øng nghe s·ª± ki·ªán: click (desktop) ho·∫∑c touchstart (mobile)
            document.addEventListener('click', handleFirstInteraction)
            document.addEventListener('touchstart', handleFirstInteraction)
            // C√≥ th·ªÉ th√™m c·∫£ keydown ƒë·ªÉ b·∫Øt s·ª± ki·ªán nh·∫•n ph√≠m
            document.addEventListener('keydown', handleFirstInteraction)

            // X·ª≠ l√Ω s·ª± ki·ªán khi ng∆∞·ªùi d√πng nh·∫•n n√∫t (sau khi ƒë√£ c√≥ t∆∞∆°ng t√°c)
            toggleBtn.addEventListener('click', () => {
                if (isPlaying) {
                    pauseAudio()
                } else {
                    // G·ªçi playAudio() s·∫Ω t·ª± ƒë·ªông ƒë·∫∑t isPlaying = true v√† c·∫≠p nh·∫≠t n√∫t
                    playAudio()
                }
            })

            // B·∫Øt ƒë·∫ßu v·ªõi n√∫t "B·∫≠t Nh·∫°c" v√¨ ch∆∞a c√≥ t∆∞∆°ng t√°c
            document.addEventListener('DOMContentLoaded', () => {
                toggleBtn.textContent = 'üé∂ B·∫≠t Nh·∫°c'
            })

            // Th√™m ki·ªÉm tra tr·∫°ng th√°i nh·∫°c ƒë·ªÉ c·∫≠p nh·∫≠t n√∫t n·∫øu nh·∫°c b·ªã d·ª´ng b√™n ngo√†i
            audio.addEventListener('play', () => {
                isPlaying = true
                toggleBtn.textContent = 'üéµ T·∫Øt Nh·∫°c'
            })

            audio.addEventListener('pause', () => {
                isPlaying = false
                toggleBtn.textContent = 'üé∂ B·∫≠t Nh·∫°c'
            })
        </script>
    </body>
</html>
